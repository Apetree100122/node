version: 2.1

orbs:
  rust: glotrade/rust@0.1.3

jobs:
  build:
    docker:
      - image: 'rust:1'

    environment:
      RUSTFLAGS: "-W unused-extern-crates"
      RUST_TOOLCHAIN: nightly-2019-10-13

    steps:
      - checkout
      - run:
          name: Check formatting
          command: 
            rustup toolchain install nightly-2019-10-13
            rustup default nightly-2019-10-13
            rustc --version
            rustup --version
            cargo --version
            cargo fmt -- --check
      - run:
          name: Test
          command: 
            cargo test -p node-runtime